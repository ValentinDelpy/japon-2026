<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Little Domo Very Arigato ‚Äî Japon 2026</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f0ede8; --surface: #faf8f5; --border: #e2ddd6;
  --sage: #7a9e8e; --blush: #c47e7e; --sky: #7a9bb5; --amber: #b8924a;
  --ink: #2a2520; --ink3: #8a8078; --snow: #fdfcfa;
  --panel-w: 360px; --hdr-h: 70px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Outfit', sans-serif; color: var(--ink); background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

/* --- HEADER --- */
header {
  height: var(--hdr-h); background: var(--snow); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 20px; z-index: 1000; gap: 20px;
}
.logo-main { font-family: 'Shippori Mincho', serif; font-weight: 700; font-size: 1.1rem; }
.hdr-weather-global { margin-left: auto; font-size: 0.8rem; background: #eee; padding: 5px 12px; border-radius: 20px; color: var(--ink3); }

/* --- MAIN LAYOUT --- */
.main-container { flex: 1; display: flex; position: relative; overflow: hidden; }
#map { flex: 1; z-index: 1; }

/* --- SIDE PANEL --- */
.panel {
  width: var(--panel-w); background: var(--surface); border-left: 1px solid var(--border);
  display: flex; flex-direction: column; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 100;
}
.scroll-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; scrollbar-width: thin; }

/* --- CARDS --- */
.stop-card {
  background: var(--snow); border: 1.5px solid var(--border); border-radius: 12px;
  cursor: pointer; transition: all 0.3s ease; overflow: hidden;
}
.stop-card:hover { border-color: var(--border2); }
.stop-card.active { border-color: var(--blush); box-shadow: 0 8px 20px rgba(0,0,0,0.06); }

.card-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
.card-city { font-family: 'Shippori Mincho', serif; font-size: 1.1rem; font-weight: 700; }
.card-meta { font-size: 0.7rem; color: var(--ink3); }
.arrow { transition: transform 0.3s; font-size: 0.8rem; color: var(--border2); }
.stop-card.expanded .arrow { transform: rotate(180deg); }

.card-content { 
  max-height: 0; opacity: 0; overflow: hidden; 
  transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
}
.stop-card.expanded .card-content { max-height: 1000px; opacity: 1; border-top: 1px solid var(--border); }

.content-inner { padding: 15px; display: flex; flex-direction: column; gap: 12px; font-size: 0.85rem; }

/* --- ELEMENTS --- */
.weather-box {
  background: #f8f9ff; border: 1px solid #dee2ff; padding: 10px; border-radius: 8px;
  display: flex; align-items: center; gap: 10px;
}
.weather-temp { font-weight: 600; color: #4a5dff; }
.lodge-link { display: block; background: var(--bg); padding: 10px; border-radius: 8px; text-decoration: none; color: inherit; border: 1px solid transparent; transition: 0.2s; }
.lodge-link:hover { border-color: var(--amber); background: white; }

/* --- POPUP --- */
.pop-img { width: 100%; height: 100px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; display: block; }

/* --- MOBILE --- */
.mobile-toggle { 
  display: none; position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%); 
  z-index: 1001; background: var(--ink); color: white; border: none; 
  padding: 14px 28px; border-radius: 40px; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

@media (max-width: 850px) {
  .panel { position: absolute; right: 0; top: 0; bottom: 0; width: 100%; transform: translateX(100%); }
  .panel.open { transform: translateX(0); }
  .mobile-toggle { display: block; }
}
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-main">Little Domo Very Arigato</div>
    <div style="font-size:0.7rem; color:var(--ink3)">Voyage Japon ¬∑ 2026</div>
  </div>
  <div class="hdr-weather-global">üçÇ Nov-D√©c : 10¬∞C - 18¬∞C</div>
</header>

<div class="main-container">
  <div id="map"></div>
  
  <button class="mobile-toggle" id="mBtn" onclick="togglePanel()">Voir l'itin√©raire</button>

  <aside class="panel" id="panel">
    <div style="padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
      <h2 style="font-family:'Shippori Mincho'">Itin√©raire</h2>
      <button onclick="togglePanel()" class="close-mobile" style="background:none; border:none; font-size:1.5rem; display:none;">√ó</button>
    </div>
    <div class="scroll-area" id="stop-list"></div>
  </aside>
</div>

<script>
const STOPS = [
  {
    city: 'Tokyo', dates: '19 ‚Äì 21 nov', lat: 35.6762, lng: 139.6503,
    img: 'https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=400&q=80',
    weather: { temp: "14¬∞C", desc: "Ensoleill√© et sec", icon: "‚òÄÔ∏è" },
    logement: "Airbnb Shibuya", prix: "363‚Ç¨", activites: ["March√© Tsukiji", "Shibuya Crossing", "TeamLab Borderless"]
  },
  {
    city: 'Kanazawa', dates: '22 nov', lat: 36.5613, lng: 136.6562,
    img: 'https://images.unsplash.com/photo-1590235242582-706709d78993?auto=format&fit=crop&w=400&q=80',
    weather: { temp: "11¬∞C", desc: "Brise fra√Æche", icon: "‚òÅÔ∏è" },
    logement: "Ryokan local", prix: "250‚Ç¨", activites: ["Jardin Kenroku-en", "Quartier Higashi Chaya"]
  },
  {
    city: 'Kyoto', dates: '25 ‚Äì 27 nov', lat: 35.0116, lng: 135.7681,
    img: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=400&q=80',
    weather: { temp: "12¬∞C", desc: "Couleurs d'automne (Momiji)", icon: "üçÅ" },
    logement: "Kyo-Machiya", prix: "250‚Ç¨", activites: ["Fushimi Inari", "Nara (Cerfs)", "Pavillon d'Or"]
  },
  {
    city: 'Osaka', dates: '29 nov ‚Äì 1 d√©c', lat: 34.6937, lng: 135.5023,
    img: 'https://images.unsplash.com/photo-1590559899731-a382839e5549?auto=format&fit=crop&w=400&q=80',
    weather: { temp: "13¬∞C", desc: "Ciel clair", icon: "üåô" },
    logement: "Hotel Namba", prix: "100‚Ç¨", activites: ["Universal Studios", "Street Food Dotonbori"]
  }
];

// Map Setup
const map = L.map('map', { zoomControl: false });
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

const markers = [];

function renderUI() {
  const list = document.getElementById('stop-list');
  
  STOPS.forEach((stop, i) => {
    // Marqueur
    const marker = L.marker([stop.lat, stop.lng]).addTo(map);
    marker.bindPopup(`
      <img src="${stop.img}" class="pop-img">
      <b style="font-family:Shippori Mincho">${stop.city}</b><br>
      <span style="font-size:0.75rem">${stop.dates}</span>
    `);
    markers.push(marker);

    // Carte
    const card = document.createElement('div');
    card.className = 'stop-card';
    card.id = `card-${i}`;
    card.innerHTML = `
      <div class="card-header">
        <div>
          <div class="card-city">${stop.city}</div>
          <div class="card-meta">${stop.dates}</div>
        </div>
        <div class="arrow">‚ñº</div>
      </div>
      <div class="card-content">
        <div class="content-inner">
          <div class="weather-box">
            <span style="font-size:1.2rem">${stop.weather.icon}</span>
            <div>
              <div class="weather-temp">${stop.weather.temp} (Moyenne)</div>
              <div style="font-size:0.7rem; color:var(--ink3)">${stop.weather.desc}</div>
            </div>
          </div>
          <a href="#" class="lodge-link">
            <div style="font-size:0.6rem; color:var(--amber); font-weight:600; text-transform:uppercase">Logement</div>
            <div style="display:flex; justify-content:space-between; align-items:center">
               <span>${stop.logement}</span>
               <span style="font-weight:600">${stop.prix}</span>
            </div>
          </a>
          <div>
            <div style="font-size:0.6rem; color:var(--blush); font-weight:600; margin-bottom:5px">PROGRAMME</div>
            <div style="display:flex; flex-wrap:wrap; gap:5px">
              ${stop.activites.map(a => `<span style="background:var(--bg); padding:3px 8px; border-radius:4px; font-size:0.7rem">${a}</span>`).join('')}
            </div>
          </div>
        </div>
      </div>
    `;

    card.onclick = (e) => {
      // Si on clique sur le lien du logement, on ne ferme pas la carte
      if(e.target.closest('.lodge-link')) return;
      selectStop(i);
    };
    list.appendChild(card);
  });
}

function selectStop(index) {
  const allCards = document.querySelectorAll('.stop-card');
  const isAlreadyExpanded = allCards[index].classList.contains('expanded');

  allCards.forEach((c, i) => {
    c.classList.remove('active', 'expanded');
  });

  if(!isAlreadyExpanded) {
    allCards[index].classList.add('active', 'expanded');
    const stop = STOPS[index];
    map.flyTo([stop.lat, stop.lng], 12, { duration: 1.5 });
    setTimeout(() => markers[index].openPopup(), 1000);
    
    // Auto-scroll pour mobile
    allCards[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

function togglePanel() {
  const p = document.getElementById('panel');
  const btn = document.getElementById('mBtn');
  const isOpen = p.classList.toggle('open');
  btn.textContent = isOpen ? "Fermer" : "Voir l'itin√©raire";
}

renderUI();
map.fitBounds(STOPS.map(s => [s.lat, s.lng]), { padding: [50, 50] });
</script>
</body>
</html>